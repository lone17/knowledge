---
aliases: 
tags: 
modified: 2025-01-28 21:38 +07:00
created: 2024-11-28 17:31 +07:00
---
#maths/algebra 

# Problem statement
Given 2 vectors $x$ and $y$ with angle $\theta$, how to compute the rotation matrix that rotates $u$ to $v$ along the 2d subspace generated by $x$ and $y$ ?

# Idea
In high dimensional space, the rotation happens:
- along the 2D plane $P$ generated by $x$ and $y$
- around the complemented (n-2)-dimensional subspace $Q$, which means this stays the same

Thus the idea is
1. Project onto $P$
2. Rotate in $P$
3. Project onto Q
4. Sum the projections onto Q with the rotated vector in $P$

Here are the steps:
- In the 2D plane generated by $x$ and $y$: 
	- The projection in to this space is given by 
	  $$P = uu^T + vv^T$$
	- mapping $P$ to $\mathbb{R}^ 2$ and do the rotation there
		- find 2 orthonormal vectors from $x$ and $y$ to represent that space
		  $$
		  \begin{align}
		  u &\leftarrow \frac{x}{||x||} \\
		  v &\leftarrow y - (y \cdot u)u \\
		  v &\leftarrow \frac{v}{||v||}
		  \end{align}
		  $$
		  then $u$ and $v$ are 2 bases of a plane and $[u \; v]$ is the projection matrix to that plane. ($\cdot [u \; v]$)
	- do the rotation with angle $\theta$ in that space ($\cdot R_\theta$)
	  $$
	  R_\theta =
	  \begin{bmatrix}
	  cos(\theta) & -sin(\theta) \\
	  sin(\theta) & cos(\theta)
	  \end{bmatrix}
	  $$
	  where $cos(\theta) = \frac{x \cdot y}{||x|| ||y||}$
		- then projected back to n-dimensional ($\cdot [u \; v]^T$)
- In complemented (n - 2)-dimensional subspace:
	- Which is the complemented (n-2)-dimensional subspace of the 2D plane mentioned above
	- The projection on to this can be computed by subtracting the projection matrix onto the space generated by $x$ and $y$ from the identity matrix
	  $$Q = I - P$$
- The final rotation matrix is
  $$
  \begin{align}
  R &= I - (uu^T + vv^T) + [u \; v] \, R_\theta \,[u \; v]^T \\
  &= I + (uv^T - vu^T)sin(\theta) + (uu^T + vv^T)(cos(\theta) - 1)
  \end{align}
  $$
# Implementation
```python
import numpy as np

# number of dimensions
n = 17

# 2 random vectors
x = np.random.rand(17)
y = np.random.rand(17)

# compute 2 orthonormal vectors to describe the plane
u = x / np.linalg.norm(x)
v = y - (y @ u) * u
v = v / np.linalg.norm(v)

# compute the rotation matrix (counter-clockwise)
cos_theta = x @ y / np.linalg.norm(x) / np.linalg.norm(y)
sin_theta = np.sqrt(1 -  cos_theta ** 2)
R_theta = [
	 [cos_theta, -sin_theta], 
	 [sin_theta, cos_theta]
]

# the final transformation
uv = np.column_stack([u, v])
u = u.reshape(-1, u.shape[-1])
v = v.reshape(-1, v.shape[-1])
R = np.eye(n) - (np.outer(u, u) + np.outer(v, v)) + uv @ R_theta @ uv.T
```
# References
- [linear algebra - Finding the rotation matrix in n-dimensions - Mathematics Stack Exchange](https://math.stackexchange.com/questions/598750/finding-the-rotation-matrix-in-n-dimensions)

